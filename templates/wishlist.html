{% extends "base.html" %}
{% block content %}
<h2>{{ team.name }}'s Wishlist</h2>
<p>Owner: {{ team.owner }}</p>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; align-items: start;">
    <!-- Left Column: Wishlist -->
    <div>
        <h3>My Wishlist (Drag to Reorder)</h3>

        <!-- Scrollable wishlist -->
        <div id="wishlist" style="
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            min-height: 200px;
            max-height: 600px;
            overflow-y: auto;
            overflow-x: hidden;
            border: 1px solid #ddd;
        ">
            {% if wishlist %}
                {% for item in wishlist %}
                <div class="wishlist-item" data-player-id="{{ item.player.id }}"
                     style="background: white; padding: 10px; margin: 5px 0; border-radius: 4px; cursor: move; border: 1px solid #ddd;
                            {% if item.player.status and item.player.status != 'Available' %}
                                {% if 'injured' in item.player.status|lower or 'doubtful' in item.player.status|lower %}
                                    background-color: #ffebee; border-left: 4px solid #d32f2f;
                                {% elif 'suspended' in item.player.status|lower %}
                                    background-color: #fff3e0; border-left: 4px solid #ff9800;
                                {% endif %}
                            {% endif %}">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="flex: 1;">
                            <strong>#{{ item.rank }}. {{ item.player.name }}</strong>
                            <span class="position-badge position-{{ item.player.position }}">{{ item.player.position }}</span>
                            <span style="color: #666;">{{ item.player.team }}</span>

                            {% if item.player.drafted %}
                                <span style="color: red; font-weight: bold;">[DRAFTED]</span>
                            {% endif %}

                            {% if item.player.status and item.player.status != 'Available' %}
                                {% if 'injured' in item.player.status|lower or 'doubtful' in item.player.status|lower %}
                                    <span style="color: #d32f2f; font-size: 11px;">üöë</span>
                                {% elif 'suspended' in item.player.status|lower %}
                                    <span style="color: #ff9800; font-size: 11px;">‚ö†Ô∏è</span>
                                {% endif %}
                            {% endif %}

                            <div style="font-size: 12px; color: #666;">
                                {% if item.player.now_cost %}¬£{{ "%.1f"|format(item.player.now_cost) }}m | {% endif %}
                                Points: {{ item.player.total_points or 'N/A' }} |
                                PPG: {{ "%.1f"|format(item.player.points_per_game) if item.player.points_per_game else 'N/A' }}
                                {% if item.player.goals_scored or item.player.assists %}
                                    | G: {{ item.player.goals_scored or 0 }} A: {{ item.player.assists or 0 }}
                                {% endif %}
                            </div>

                            {% if item.player.status and item.player.status != 'Available' %}
                                <div style="font-size: 11px; color: #d32f2f; margin-top: 3px;">
                                    Status: {{ item.player.status }}
                                </div>
                            {% endif %}
                        </div>

                        <form method="POST" action="{{ url_for('remove_from_wishlist', team_id=team.id, player_id=item.player.id) }}" style="display: inline;">
                            <button type="submit" class="btn" style="background-color: #d32f2f; padding: 5px 10px; font-size: 12px;">√ó</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p style="color: #666; text-align: center; padding: 50px 0;">No players in wishlist yet</p>
            {% endif %}
        </div>

        <!-- Wishlist summary -->
        <div style="margin-top: 10px; padding: 8px; background-color: #f0f0f0; border-radius: 4px; font-size: 12px;">
            <div>
                {% set pos_counts = {} %}
                {% for item in wishlist if not item.player.drafted %}
                    {% set _ = pos_counts.update({item.player.position: pos_counts.get(item.player.position, 0) + 1}) %}
                {% endfor %}

                <strong>Position Summary:</strong>
                {% for pos in ['GK', 'DEF', 'MID', 'FWD'] %}
                    <span class="position-badge position-{{ pos }}" style="font-size: 11px;">{{ pos }}: {{ pos_counts.get(pos, 0) }}</span>
                {% endfor %}
            </div>
            <div style="margin-top: 5px;">
                <strong>Total:</strong> {{ wishlist|length }} players
                {% if wishlist|length > 0 %} | <strong>Top pick:</strong> {{ wishlist[0].player.name }}{% endif %}
            </div>
        </div>

        <!-- Compact tips -->
        <div style="margin-top: 10px; font-size: 11px; color: #666;">
            üí° Drag to reorder | Scroll to see all | #1 = highest priority | Hover for player details
        </div>
    </div>

    <!-- Right Column: Add Players -->
    <div>
        <h3>Add Players to Wishlist</h3>

        <!-- Enhanced Filter Controls -->
        <div style="background-color: #f5f5f5; padding: 10px; border-radius: 4px; margin-bottom: 10px;">
            <!-- Search Box -->
            <div style="margin-bottom: 10px;">
                <input type="text"
                       id="playerSearch"
                       placeholder="üîç Search by player name..."
                       style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px;">
            </div>

            <!-- Filter dropdowns -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                <!-- Position Filter -->
                <div>
                    <label style="font-size: 11px;">Position:</label>
                    <select id="positionSelect" onchange="updateWishlistFilters()" style="width: 100%; padding: 3px; font-size: 12px;">
                        <option value="all" {% if current_position =='all' %}selected{% endif %}>All</option>
                        <option value="GK" {% if current_position =='GK' %}selected{% endif %}>GK</option>
                        <option value="DEF" {% if current_position =='DEF' %}selected{% endif %}>DEF</option>
                        <option value="MID" {% if current_position =='MID' %}selected{% endif %}>MID</option>
                        <option value="FWD" {% if current_position =='FWD' %}selected{% endif %}>FWD</option>
                    </select>
                </div>

                <!-- Team Filter -->
                <div>
                    <label style="font-size: 11px;">Team:</label>
                    <select id="teamSelect" onchange="updateWishlistFilters()" style="width: 100%; padding: 3px; font-size: 12px;">
                        <option value="all">All Teams</option>
                        {% set teams = available_players | map(attribute='team') | unique | sort %}
                        {% for team in teams %}
                            <option value="{{ team }}" {% if current_team_filter == team %}selected{% endif %}>{{ team }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <!-- Sort Dropdown -->
            <div style="margin-top: 5px;">
                <label style="font-size: 11px;">Sort by:</label>
                <select id="sortSelect" onchange="updateWishlistFilters()" style="width: 100%; padding: 3px; font-size: 12px;">
                    <option value="total_points" {% if current_sort =='total_points' %}selected{% endif %}>Total Points</option>
                    <option value="points_per_game" {% if current_sort =='points_per_game' %}selected{% endif %}>Points Per Game</option>
                    <option value="now_cost" {% if current_sort =='now_cost' %}selected{% endif %}>Price</option>
                    <option value="goals_scored" {% if current_sort =='goals_scored' %}selected{% endif %}>Goals</option>
                    <option value="assists" {% if current_sort =='assists' %}selected{% endif %}>Assists</option>
                    <option value="minutes" {% if current_sort =='minutes' %}selected{% endif %}>Minutes</option>
                    <option value="name" {% if current_sort =='name' %}selected{% endif %}>Name</option>
                </select>
            </div>
        </div>
    </div>
</div>